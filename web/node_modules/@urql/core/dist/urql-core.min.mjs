import{toPromise as e,take as t,share as n,filter as r,map as o,tap as i,merge as u,mergeMap as c,takeUntil as p,make as h,onPush as l,makeSubject as d,publish as y,onStart as k,onEnd as v,switchMap as x,fromValue as q,interval as O,subscribe as b}from"wonka";import{k as w,_ as E,C as _,m as S,a as j,b as P,c as R,d as M,e as Q,f as D}from"./936d08fe.min.mjs";import{visit as A}from"graphql/language/visitor.mjs";import{Kind as L}from"graphql/language/kinds.mjs";import{print as I}from"graphql/language/printer.mjs";import{Source as N}from"graphql/language/source.mjs";export{C as CombinedError,f as createRequest,g as getOperationName,a as makeErrorResult,m as makeResult,s as stringifyVariables}from"./936d08fe.min.mjs";function T(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)T(e[n],t);else if("object"==typeof e&&null!==e)for(n in e)"__typename"===n&&"string"==typeof e[n]?t[e[n]]=0:T(e[n],t);return t}function $(e){return e.kind===L.FIELD&&"__typename"===e.name.value&&!e.alias}function F(e){if(e.selectionSet&&!e.selectionSet.selections.some($))return E({},e,{selectionSet:E({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:L.FIELD,name:{kind:L.NAME,value:"__typename"}}])})})}var G=new Map;function J(e){e=w(e);var t=G.get(e.__key);return t||((t=A(e,{Field:F,InlineFragment:F})).__key=e.__key,G.set(e.__key,t)),t}function U(e){return e&&"object"==typeof e?Object.keys(e).reduce((function(t,n){var r=e[n];return"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:r}):t[n]=Array.isArray(r)?r.map(U):r&&"object"==typeof r&&"__typename"in r?U(r):r,t}),{}):e}function V(n){return n.toPromise=function(){return e(t(1)(n))},n}function z(e,t,n){return n||(n=t.context),{key:t.key,query:t.query,variables:t.variables,kind:e,context:n,get operationName(){return this.kind}}}function B(e,t){return z(e.kind,e,E({},e.context,{meta:E({},e.context.meta,t)}))}function H(){}function K(e){return"subscription"!==(e=e.kind)&&"query"!==e}function W(e){return e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message}function X(e){return"mutation"!==(e=e.kind)&&"query"!==e}function Y(e){var t=z(e.kind,e);return t.query=J(e.query),t}function Z(e){return"query"!==e.kind||"cache-only"!==e.context.requestPolicy}function ee(e){return B(e,{cacheOutcome:"miss"})}function te(e){return X(e)}function ne(e){function t(e){var t=e.context.requestPolicy;return"query"===e.kind&&"network-only"!==t&&("cache-only"===t||l.has(e.key))}function a(e){var t=l.get(e.key);return t=E({},t,{operation:B(e,{cacheOutcome:t?"hit":"miss"})}),"cache-and-network"===e.context.requestPolicy&&(t.stale=!0,re(h,e)),t}function s(e){return!X(e)&&t(e)}function c(e){function t(e){o.add(e)}var n=e.operation;if(n){var r=Object.keys(T(e.data,{})).concat(n.context.additionalTypenames||[]);if("mutation"===e.operation.kind){var o=new Set;for(e=0;e<r.length;e++){var i=r[e];(i=d[i]||(d[i]=new Set)).forEach(t),i.clear()}o.forEach((function(e){l.has(e)&&(n=l.get(e).operation,l.delete(e),re(h,n))}))}else if("query"===n.kind&&e.data)for(l.set(n.key,e),e=0;e<r.length;e++)(d[i=r[e]]||(d[i]=new Set)).add(n.key)}}function f(e){return!X(e)&&!t(e)}var p=e.forward,h=e.client,l=new Map,d=Object.create(null);return function(e){var t=n(e);return e=o(a)(r(s)(t)),t=i(c)(p(r(Z)(o(ee)(u([o(Y)(r(f)(t)),r(te)(t)]))))),u([e,t])}}function re(e,t){return e.reexecuteOperation(z(t.kind,t,E({},t.context,{requestPolicy:"network-only"})))}function oe(e){function t(e){u.delete(e.operation.key)}function n(e){var t=e.key;return"teardown"===(e=e.kind)?(u.delete(t),!0):"query"!==e&&"subscription"!==e||(e=u.has(t),u.add(t),!e)}var o=e.forward,u=new Set;return function(e){return e=r(n)(e),i(t)(o(e))}}function ie(e){return"query"===e.kind||"mutation"===e.kind}function ue(e){return"query"!==e.kind&&"mutation"!==e.kind}function ae(e){var t=e.forward;return function(e){var o=n(e);e=c((function(e){var t=e.key,n=r((function(e){return"teardown"===e.kind&&e.key===t}))(o),i=P(e),u=R(e,i);return i=M(e,i),l((function(){}))(p(n)(Q(e,u,i)))}))(r(ie)(o));var i=t(r(ue)(o));return u([e,i])}}function se(){return!1}function ce(){function e(){}return function(t){return r(se)(i(e)(t))}}var fe=ce();function pe(e){return function(t){var n=t.client;return e.reduceRight((function(e,t){return t({client:n,forward:e,dispatchDebug:function(){}})}),t.forward)}}var he=[oe,ne,ae];function le(e){var t=this;this.activeOperations=Object.create(null),this.queue=[],this.createOperationContext=function(e){return e||(e={}),E({},{url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch,preferGetMethod:t.preferGetMethod},e,{suspense:e.suspense||!1!==e.suspense&&t.suspense,requestPolicy:e.requestPolicy||t.requestPolicy})},this.createRequestOperation=function(e,n,r){return z(e,n,t.createOperationContext(r))},this.executeQuery=function(e,n){return e=t.createRequestOperation("query",e,n),t.executeRequestOperation(e)},this.executeSubscription=function(e,n){return e=t.createRequestOperation("subscription",e,n),t.executeRequestOperation(e)},this.executeMutation=function(e,n){return e=t.createRequestOperation("mutation",e,n),t.executeRequestOperation(e)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.fetch=e.fetch,this.suspense=!!e.suspense,this.requestPolicy=e.requestPolicy||"cache-first",this.preferGetMethod=!!e.preferGetMethod,this.maskTypename=!!e.maskTypename;var r=d(),o=r.next;this.operations$=r.source;var i=!1;this.dispatchOperation=function(e){for(i=!0,e&&o(e);e=t.queue.shift();)o(e);i=!1},this.reexecuteOperation=function(e){("mutation"===e.kind||0<(t.activeOperations[e.key]||0))&&(t.queue.push(e),i||Promise.resolve().then(t.dispatchOperation))},e=pe(void 0!==e.exchanges?e.exchanges:he),this.results$=n(e({client:this,dispatchDebug:H,forward:ce()})(this.operations$)),y(this.results$)}function de(e){return e.data=U(e.data),e}function ye(e){return new le(e)}function ke(e){var t=e.forward;return function(e){return t(e)}}function me(e){function t(e){var t=e.error;e=e.operation,t&&n(t,e)}var n=e.onError;return function(e){var n=e.forward;return function(e){return i(t)(n(e))}}}function ve(){for(var e=arguments,t=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"",n=1;n<arguments.length;n++){var r=e[n];t+=r&&r.kind===L.DOCUMENT?r.loc?r.loc.source.body:I(r):r,t+=e[0][n]}return(e=w(t)).loc={start:0,end:t.length,source:new N(t,"gql")},e}function ge(e){function t(t){var a=t.client,c=t.forward;return function(t){var d=e&&"boolean"==typeof e.isClient?!!e.isClient:!a.suspense,y=n(t);return t=c(r(f)(y)),y=o(p)(r(h)(y)),d?y=i(s)(y):t=i(l)(t),u([t,y])}}function a(e){return!K(e)&&void 0!==d[e.key]}function s(e){y.push(e.operation.key),1===y.length&&Promise.resolve().then(c)}function c(){for(var e;e=y.shift();)delete d[e]}function f(e){return!a(e)}function p(e){var t=d[e.key],n=t.error;return{operation:e,data:(t=t.data)?JSON.parse(t):void 0,extensions:void 0,error:n?new _({networkError:n.networkError?Error(n.networkError):void 0,graphQLErrors:n.graphQLErrors&&n.graphQLErrors.length?n.graphQLErrors:void 0}):void 0}}function h(e){return a(e)}function l(e){var t=e.operation;if(!K(t)){var n=e.data;e=e.error;var r={};void 0!==n&&(r.data=JSON.stringify(n)),e&&(r.error={graphQLErrors:e.graphQLErrors.map(W)},e.networkError&&(r.error.networkError=""+e.networkError)),d[t.key]=r}}var d={},y=[];return t.restoreData=function(e){return E(d,e)},t.extractData=function(){return E({},d)},e&&e.initialState&&t.restoreData(e.initialState),t}function xe(e){function t(e){return"subscription"===(e=e.kind)||!!i&&("query"===e||"mutation"===e)}var o=e.forwardSubscription,i=e.enableAllOperations;return function(e){function i(e){var t=o({key:e.key.toString(36),query:I(e.query),variables:e.variables,context:E({},e.context)});return h((function(n){function r(t){return a(S(e,t))}function o(t){return a(j(e,t))}function i(){f||(f=!0,"subscription"===e.kind&&s.reexecuteOperation(z("teardown",e,e.context)),c())}var u,a=n.next,c=n.complete,f=!1;return Promise.resolve().then((function(){f||(u=t.subscribe({next:r,error:o,complete:i}))})),function(){f=!0,u&&u.unsubscribe()}}))}function a(e){return!l(e)}var s=e.client,f=e.forward,l=t;return function(e){var t=n(e);e=c((function(e){var n=e.key,o=r((function(e){return"teardown"===e.kind&&e.key===n}))(t);return p(o)(i(e))}))(r(l)(t));var o=f(r(a)(t));return u([e,o])}}}le.prototype.onOperationStart=function(e){var t=e.key;this.activeOperations[t]=(this.activeOperations[t]||0)+1,this.dispatchOperation(e)},le.prototype.onOperationEnd=function(e){var t=e.key,n=this.activeOperations[t]||0;if(0>=(this.activeOperations[t]=0>=n?0:n-1)){for(t=this.queue.length-1;0<=t;t--)this.queue[t].key===e.key&&this.queue.splice(t,1);this.dispatchOperation(z("teardown",e,e.context))}},le.prototype.executeRequestOperation=function(e){var n=this,i=r((function(t){return t.operation.key===e.key}))(this.results$);if(this.maskTypename&&(i=o(de)(i)),"mutation"===e.kind)return t(1)(k((function(){return n.dispatchOperation(e)}))(i));var a=r((function(t){return"teardown"===t.kind&&t.key===e.key}))(this.operations$),s=v((function(){n.onOperationEnd(e)}))(k((function(){n.onOperationStart(e)}))(p(a)(i)));return"query"===e.kind&&e.context.pollInterval?x((function(){return s}))(u([q(0),O(e.context.pollInterval)])):s},le.prototype.query=function(e,t,n){return n&&"boolean"==typeof n.suspense||(n=E({},n,{suspense:!1})),V(this.executeQuery(D(e,t),n))},le.prototype.readQuery=function(e,t,n){var r=null;return b((function(e){r=e}))(this.executeQuery(D(e,t),n)).unsubscribe(),r},le.prototype.subscription=function(e,t,n){return this.executeSubscription(D(e,t),n)},le.prototype.mutation=function(e,t,n){return V(this.executeMutation(D(e,t),n))};export{le as Client,ne as cacheExchange,pe as composeExchanges,ye as createClient,ke as debugExchange,oe as dedupExchange,he as defaultExchanges,me as errorExchange,fe as fallbackExchangeIO,ae as fetchExchange,J as formatDocument,ve as gql,z as makeOperation,U as maskTypename,ge as ssrExchange,xe as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
