import{visit as e}from"graphql/language/visitor.mjs";import{Kind as t}from"graphql/language/kinds.mjs";import{print as n}from"graphql/language/printer.mjs";import{toPromise as r,take as o,share as i,filter as u,map as c,tap as p,merge as h,mergeMap as d,takeUntil as l,make as y,onPush as k,makeSubject as v,publish as x,onStart as q,onEnd as O,switchMap as b,fromValue as w,interval as E,subscribe as S}from"wonka";import{_,C as P,m as j,a as R,b as Q,c as D,d as L,e as M,f as A}from"./1c4cf6ed.min.mjs";export{C as CombinedError,f as createRequest,g as getOperationName,a as makeErrorResult,m as makeResult,s as stringifyVariables}from"./1c4cf6ed.min.mjs";function I(e,t){if(void 0===t&&(t=[]),Array.isArray(e))e.forEach((function(e){I(e,t)}));else if("object"==typeof e&&null!==e)for(var n in e)"__typename"===n&&"string"==typeof e[n]?t.push(e[n]):I(e[n],t);return t}function T(e,t,n){return n.indexOf(e)===t}function $(e){return e.kind===t.FIELD&&"__typename"===e.name.value}function N(e){if(e.selectionSet&&!e.selectionSet.selections.some($))return _({},e,{selectionSet:_({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:t.FIELD,name:{kind:t.NAME,value:"__typename"}}])})})}function F(t){var n=e(t,{Field:N,InlineFragment:N});return n.__key=t.__key,n}function G(e){return e&&"object"==typeof e?Object.keys(e).reduce((function(t,n){var r=e[n];return"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:r}):t[n]=Array.isArray(r)?r.map(G):r&&"object"==typeof r&&"__typename"in r?G(r):r,t}),{}):e}function J(e){return e.toPromise=function(){return r(o(1)(e))},e}function V(e,t,n){return n||(n=t.context),{key:t.key,query:t.query,variables:t.variables,kind:e,context:n,get operationName(){return this.kind}}}function z(e,t){return V(e.kind,e,_({},e.context,{meta:_({},e.context.meta,t)}))}function B(){}function H(e){return"subscription"!==(e=e.kind)&&"query"!==e}function K(e){return e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message}function U(e){return"mutation"!==(e=e.kind)&&"query"!==e}function W(e){var t=V(e.kind,e);return t.query=F(e.query),t}function X(e){return"query"!==e.kind||"cache-only"!==e.context.requestPolicy}function Y(e){return z(e,{cacheOutcome:"miss"})}function Z(e){return U(e)}function ee(e){function t(e){var t=e.context.requestPolicy;return"query"===e.kind&&"network-only"!==t&&("cache-only"===t||d.has(e.key))}function n(e){var t=d.get(e.key);return t=_({},t,{operation:z(e,{cacheOutcome:t?"hit":"miss"})}),"cache-and-network"===e.context.requestPolicy&&(t.stale=!0,te(f,e)),t}function r(e){return!U(e)&&t(e)}function o(e){e.operation&&"mutation"===e.operation.kind?y(e):e.operation&&"query"===e.operation.kind&&k(e)}function a(e){return!U(e)&&!t(e)}var s=e.forward,f=e.client;e=e.dispatchDebug;var d=new Map,l=Object.create(null),y=function(e,t,n){function r(t){if(e.has(t)){var r=e.get(t).operation;e.delete(t),te(n,r)}}return function(e){function n(e){o.add(e)}var o=new Set,i=e.operation.context.additionalTypenames;(e=I(e.data).filter(T).concat(i||[])).forEach((function(e){(e=t[e]||(t[e]=new Set)).forEach(n),e.clear()})),o.forEach(r)}}(d,l,f),k=function(e,t){return function(n){var r=n.operation,o=n.data,i=r.context.additionalTypenames;null!=o&&(e.set(r.key,{operation:r,data:o,error:n.error}),I(n.data).filter(T).concat(i||[]).forEach((function(e){(t[e]||(t[e]=new Set)).add(r.key)})))}}(d,l);return function(e){var t=i(e);return e=c(n)(u(r)(t)),t=p(o)(s(u(X)(c(Y)(h([c(W)(u(a)(t)),u(Z)(t)]))))),h([e,t])}}function te(e,t){return e.reexecuteOperation(V(t.kind,t,_({},t.context,{requestPolicy:"network-only"})))}function ne(e){function t(e){o.delete(e.operation.key)}function n(e){var t=e.key;return"teardown"===(e=e.kind)?(o.delete(t),!0):"query"!==e&&"subscription"!==e||(e=o.has(t),o.add(t),!e)}var r=e.forward,o=new Set;return function(e){return e=u(n)(e),p(t)(r(e))}}function re(e){return"query"===e.kind||"mutation"===e.kind}function oe(e){return"query"!==e.kind&&"mutation"!==e.kind}function ie(e){var t=e.forward;return function(e){var n=i(e);e=d((function(e){var t=e.key,r=u((function(e){return"teardown"===e.kind&&e.key===t}))(n),o=Q(e),i=D(e,o);return o=L(e,o),k((function(){}))(l(r)(M(e,i,o)))}))(u(re)(n));var r=t(u(oe)(n));return h([e,r])}}function ue(){return!1}function ae(){function e(){}return function(t){return u(ue)(p(e)(t))}}var ce=ae();function se(e){return function(t){var n=t.client;return e.reduceRight((function(e,t){return t({client:n,forward:e,dispatchDebug:function(){}})}),t.forward)}}var fe=[ne,ee,ie];function pe(e){var t=this;this.activeOperations=Object.create(null),this.queue=[],this.createOperationContext=function(e){return e||(e={}),_({},{url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch,preferGetMethod:t.preferGetMethod},e,{suspense:e.suspense||!1!==e.suspense&&t.suspense,requestPolicy:e.requestPolicy||t.requestPolicy})},this.createRequestOperation=function(e,n,r){return V(e,n,t.createOperationContext(r))},this.executeQuery=function(e,n){return e=t.createRequestOperation("query",e,n),t.executeRequestOperation(e)},this.executeSubscription=function(e,n){return e=t.createRequestOperation("subscription",e,n),t.executeRequestOperation(e)},this.executeMutation=function(e,n){return e=t.createRequestOperation("mutation",e,n),t.executeRequestOperation(e)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.fetch=e.fetch,this.suspense=!!e.suspense,this.requestPolicy=e.requestPolicy||"cache-first",this.preferGetMethod=!!e.preferGetMethod,this.maskTypename=!!e.maskTypename;var n=v(),r=n.next;this.operations$=n.source;var o=!1;this.dispatchOperation=function(e){for(o=!0,e&&r(e);e=t.queue.shift();)r(e);o=!1},this.reexecuteOperation=function(e){("mutation"===e.kind||0<(t.activeOperations[e.key]||0))&&(t.queue.push(e),o||Promise.resolve().then(t.dispatchOperation))},e=se(void 0!==e.exchanges?e.exchanges:fe),this.results$=i(e({client:this,dispatchDebug:B,forward:ae()})(this.operations$)),x(this.results$)}function he(e){return e.data=G(e.data),e}function de(e){return new pe(e)}function le(e){var t=e.forward;return function(e){return t(e)}}function ye(e){function t(e){var t=e.error;e=e.operation,t&&n(t,e)}var n=e.onError;return function(e){var n=e.forward;return function(e){return p(t)(n(e))}}}function ke(e){function t(t){var n=t.client,o=t.forward;return function(t){var l=e&&"boolean"==typeof e.isClient?!!e.isClient:!n.suspense,y=i(t);return t=o(u(a)(y)),y=c(s)(u(f)(y)),l?y=p(r)(y):t=p(d)(t),h([t,y])}}function n(e){return!H(e)&&void 0!==l[e.key]}function r(e){y.push(e.operation.key),1===y.length&&Promise.resolve().then(o)}function o(){for(var e;e=y.shift();)delete l[e]}function a(e){return!n(e)}function s(e){var t=l[e.key],n=t.error;return{operation:e,data:(t=t.data)?JSON.parse(t):void 0,extensions:void 0,error:n?new P({networkError:n.networkError?Error(n.networkError):void 0,graphQLErrors:n.graphQLErrors&&n.graphQLErrors.length?n.graphQLErrors:void 0}):void 0}}function f(e){return n(e)}function d(e){var t=e.operation;if(!H(t)){var n=e.data;e=e.error;var r={};void 0!==n&&(r.data=JSON.stringify(n)),e&&(r.error={graphQLErrors:e.graphQLErrors.map(K)},e.networkError&&(r.error.networkError=""+e.networkError)),l[t.key]=r}}var l={},y=[];return t.restoreData=function(e){return _(l,e)},t.extractData=function(){return _({},l)},e&&e.initialState&&t.restoreData(e.initialState),t}function me(e){function t(e){return"subscription"===(e=e.kind)||!!o&&("query"===e||"mutation"===e)}var r=e.forwardSubscription,o=e.enableAllOperations;return function(e){function o(e){var t=r({key:e.key.toString(36),query:n(e.query),variables:e.variables,context:_({},e.context)});return y((function(n){function r(t){return a(j(e,t))}function o(t){return a(R(e,t))}function i(){f||(f=!0,"subscription"===e.kind&&c.reexecuteOperation(V("teardown",e,e.context)),s())}var u,a=n.next,s=n.complete,f=!1;return Promise.resolve().then((function(){f||(u=t.subscribe({next:r,error:o,complete:i}))})),function(){f=!0,u&&u.unsubscribe()}}))}function a(e){return!f(e)}var c=e.client,s=e.forward,f=t;return function(e){var t=i(e);e=d((function(e){var n=e.key,r=u((function(e){return"teardown"===e.kind&&e.key===n}))(t);return l(r)(o(e))}))(u(f)(t));var n=s(u(a)(t));return h([e,n])}}}pe.prototype.onOperationStart=function(e){var t=e.key;this.activeOperations[t]=(this.activeOperations[t]||0)+1,this.dispatchOperation(e)},pe.prototype.onOperationEnd=function(e){var t=e.key,n=this.activeOperations[t]||0;if(0>=(this.activeOperations[t]=0>=n?0:n-1)){for(t=this.queue.length-1;0<=t;t--)this.queue[t].key===e.key&&this.queue.splice(t,1);this.dispatchOperation(V("teardown",e,e.context))}},pe.prototype.executeRequestOperation=function(e){var t=this,n=u((function(t){return t.operation.key===e.key}))(this.results$);if(this.maskTypename&&(n=c(he)(n)),"mutation"===e.kind)return o(1)(q((function(){return t.dispatchOperation(e)}))(n));var r=u((function(t){return"teardown"===t.kind&&t.key===e.key}))(this.operations$),i=O((function(){t.onOperationEnd(e)}))(q((function(){t.onOperationStart(e)}))(l(r)(n)));return"query"===e.kind&&e.context.pollInterval?b((function(){return i}))(h([w(0),E(e.context.pollInterval)])):i},pe.prototype.query=function(e,t,n){return n&&"boolean"==typeof n.suspense||(n=_({},n,{suspense:!1})),J(this.executeQuery(A(e,t),n))},pe.prototype.readQuery=function(e,t,n){var r=null;return S((function(e){r=e}))(this.executeQuery(A(e,t),n)).unsubscribe(),r},pe.prototype.subscription=function(e,t,n){return this.executeSubscription(A(e,t),n)},pe.prototype.mutation=function(e,t,n){return J(this.executeMutation(A(e,t),n))};export{pe as Client,ee as cacheExchange,se as composeExchanges,de as createClient,le as debugExchange,ne as dedupExchange,fe as defaultExchanges,ye as errorExchange,ce as fallbackExchangeIO,ie as fetchExchange,F as formatDocument,V as makeOperation,G as maskTypename,ke as ssrExchange,me as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
